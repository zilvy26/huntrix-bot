require('dotenv').config();
const mongoose = require('mongoose');
const Card = require('../models/Card');

const MONGODB_URI = process.env.MONGO_URI;

(async () => {
  try {
    if (!MONGODB_URI) throw new Error('❌ MONGO_URI is not defined');
    await mongoose.connect(MONGODB_URI);

    const cardsToUpdate = await Card.find({
      designerId: { $exists: true },
      designerIds: { $exists: false },
    });

    for (const card of cardsToUpdate) {
      card.designerIds = [card.designerId];
      await card.save();
      console.log(`Migrated card ${card.cardCode} to use designerIds`);
    }

    console.log(`✅ Migration complete. Updated ${cardsToUpdate.length} cards.`);
    mongoose.disconnect();
  } catch (err) {
    console.error('❌ Migration failed:', err);
  }
})();